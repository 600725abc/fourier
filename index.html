<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>傅立葉級數動畫 | The Fourier Series Animation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Poppins:wght@300;400;500&display=swap');

        :root {
            /* New Neon/Vivid Color Palette */
            --bg-color-start: #110f18;
            --bg-color-end: #0c0b10;
            --primary-color: #00f6ff;      /* Vivid Cyan */
            --secondary-color: #ff00ff;     /* Vivid Magenta */
            --accent-color: #e8f400;       /* Vivid Lime */
            --text-color: #f0f0f0;         /* Bright White/Gray */
            --light-grey: rgba(160, 174, 192, 0.5); /* Semi-transparent grey */
            --wave-path-color: #00f6ff;
            --target-wave-color: rgba(0, 246, 255, 0.15);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-color-start), var(--bg-color-end));
            overflow: hidden;
            font-family: 'Poppins', 'Noto Sans TC', sans-serif;
            color-scheme: dark;
        }

        #main-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            transform-origin: center center;
            overflow: hidden;
        }

        #animation-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* SVG Element Styles - Bolder and more vivid with glow */
        .epicycle-circle {
            fill: none;
            stroke: var(--secondary-color);
            stroke-opacity: 0.3;
            stroke-width: 3px;
        }

        .epicycle-vector {
            stroke: var(--secondary-color);
            stroke-opacity: 0.9;
            stroke-width: 4px;
            filter: drop-shadow(0 0 4px var(--secondary-color));
        }
        
        .epicycle-dot {
            fill: var(--accent-color);
            filter: drop-shadow(0 0 5px var(--accent-color));
        }

        .final-dot {
            fill: var(--primary-color);
        }

        .wave-path {
            fill: none;
            stroke: var(--wave-path-color);
            stroke-width: 8px;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 8px var(--wave-path-color));
        }
        
        .connector-line {
            stroke: var(--primary-color);
            stroke-width: 3px;
            stroke-dasharray: 10 10;
            stroke-opacity: 0.5;
            filter: drop-shadow(0 0 3px var(--primary-color));
        }

        .target-wave {
            fill: none;
            stroke: var(--target-wave-color);
            stroke-width: 15px;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .axes {
            stroke: var(--light-grey);
            stroke-width: 4px;
            opacity: 0.6;
        }

        /* Responsive Text Elements */
        .text-overlay {
            position: absolute;
            color: var(--text-color);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            text-shadow: 0 0 15px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }

        .text-overlay.visible {
            opacity: 1;
        }

        #title {
            top: 4%;
            left: 5%;
            font-size: clamp(2rem, 5vw, 3.25rem); /* Responsive font size */
            font-weight: 500;
        }
        
        #formula-container {
            bottom: 15%; /* Positioned above the subtitles */
            left: 5%;
            width: 90%;
            font-size: clamp(1.1rem, 3vw, 2.2rem);
            background-color: rgba(17, 15, 24, 0.7);
            padding: clamp(10px, 1.5vw, 20px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateY(20px);
            transition: opacity 1s, transform 1s;
        }
        
        #formula-container p {
            margin: 0;
            white-space: normal; /* Allow wrapping on small screens */
        }
        
        #subtitle-container {
            bottom: 5%; /* Positioned at the very bottom */
            left: 5%;
            width: 90%;
            text-align: left; /* Aligned left to match formula */
        }

        .subtitle {
            margin: 0.2em 0;
        }

        #subtitle-cn {
            font-size: clamp(1rem, 2.5vw, 1.8rem);
            font-weight: 500;
        }

        #subtitle-en {
            font-size: clamp(0.9rem, 2vw, 1.5rem);
            font-weight: 300;
            opacity: 0.8;
        }
        
        /* Media Query for Portrait / Mobile devices */
        @media (max-width: 768px) and (orientation: portrait) {
            #formula-container {
                bottom: auto;
                top: 15%; /* Adjusted position */
                left: 5%;
                right: 5%;
                width: 90%;
            }

            #subtitle-container {
                 left: 5%;
                 width: 90%;
                 text-align: left;
            }
        }
    </style>
</head>
<body>
    <div id="main-container">
        <div id="title" class="text-overlay">
            <p>傅立葉級數 Fourier Series</p>
        </div>
        
        <svg id="animation-svg" viewBox="0 0 2560 1440" preserveAspectRatio="xMidYMid slice">
            <!-- Axes -->
            <line class="axes" x1="600" y1="720" x2="2500" y2="720" />
            <line class="axes" x1="1000" y1="200" x2="1000" y2="1240" />

            <!-- Target Wave -->
            <path id="target-wave" class="target-wave" d="" />
            
            <!-- Animation elements will be injected here by JS -->
            <g id="epicycles-group"></g>
            <path id="wave-path" class="wave-path" d="" />
            <line id="connector-line" class="connector-line" x1="0" y1="0" x2="0" y2="0"/>
            <circle id="final-dot" class="final-dot" cx="0" cy="0" r="12" />
        </svg>

        <div id="subtitle-container" class="text-overlay">
            <p id="subtitle-cn" class="subtitle"></p>
            <p id="subtitle-en" class="subtitle"></p>
        </div>
        
        <div id="formula-container" class="text-overlay">
             <p>f(t) ≈ c₁ sin(1ωt) + c₂ sin(3ωt) + c₃ sin(5ωt) + ...</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const epicyclesGroup = document.getElementById('epicycles-group');
        const wavePath = document.getElementById('wave-path');
        const connectorLine = document.getElementById('connector-line');
        const finalDot = document.getElementById('final-dot');
        const targetWavePath = document.getElementById('target-wave');
        const titleEl = document.getElementById('title');
        const subtitleContainer = document.getElementById('subtitle-container');
        const subtitleCN = document.getElementById('subtitle-cn');
        const subtitleEN = document.getElementById('subtitle-en');
        const formulaContainer = document.getElementById('formula-container');

        // Animation Parameters (using the SVG's coordinate system)
        const CX = 600; 
        const CY = 720;
        const WAVE_START_X = 1000;
        const AMPLITUDE = 250;
        
        let time = 0;
        let wavePoints = [];
        let numTerms = 0;
        let animationFrameId;

        // --- Timeline ---
        const timeline = [
            { time: 0,    duration: 5000,  action: 'scene1' },
            { time: 5000,  duration: 6000,  action: 'scene2' },
            { time: 11000, duration: 7000,  action: 'scene3' },
            { time: 18000, duration: 8000,  action: 'scene4' },
            { time: 26000, duration: 10000, action: 'scene5' },
            { time: 36000, duration: 10000, action: 'scene6' }
        ];

        // --- Subtitle Data (Traditional Chinese) ---
        const subtitles = {
            scene1: {
                cn: "您是否想過⋯⋯那些複雜的、不斷重複的波形⋯⋯",
                en: "Have you ever wondered... about these complex, repeating waveforms..."
            },
            scene2: {
                cn: "⋯⋯能否用一些更簡單的東西，例如圓周運動來建構？",
                en: "...if they can be constructed from something simpler, like circles?"
            },
            scene3: {
                cn: "我們從一個大圓開始。它描繪出一條正弦波，這是最初的粗略近似。",
                en: "We start with one large circle. It traces a sine wave, our first rough approximation."
            },
            scene4: {
                cn: "現在，加上一個更小、轉速快三倍的圓。看，波形開始變得更「方」了。",
                en: "Now, let's add a smaller circle, spinning three times faster. See how the wave becomes 'squarer'."
            },
            scene5: {
                cn: "隨著我們不斷添加更多、更小、轉速更快的圓⋯⋯",
                en: "As we keep adding more, smaller, and faster-spinning circles..."
            },
            scene6: {
                cn: "軌跡就無限逼近了目標方波。這就是傅立葉級數：化繁為簡的藝術。",
                en: "The path gets infinitely close to our target square wave. This is the Fourier Series: the art of decomposing complexity into simplicity."
            }
        };
        
        function setSubtitle(scene) {
            subtitleContainer.classList.remove('visible');
            setTimeout(() => {
                subtitleCN.textContent = subtitles[scene].cn;
                subtitleEN.textContent = subtitles[scene].en;
                subtitleContainer.classList.add('visible');
            }, 500);
        }

        // --- Main Animation Loop ---
        function animate() {
            let x = CX;
            let y = CY;
            epicyclesGroup.innerHTML = ''; 

            for (let i = 0; i < numTerms; i++) {
                const prevX = x;
                const prevY = y;
                const n = i * 2 + 1;
                const radius = AMPLITUDE * (4 / (n * Math.PI));
                const angle = time * n;

                x += radius * Math.cos(angle);
                y += radius * Math.sin(angle);
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('class', 'epicycle-circle');
                circle.setAttribute('cx', prevX);
                circle.setAttribute('cy', prevY);
                circle.setAttribute('r', radius);
                epicyclesGroup.appendChild(circle);

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('class', 'epicycle-vector');
                line.setAttribute('x1', prevX);
                line.setAttribute('y1', prevY);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                epicyclesGroup.appendChild(line);
                
                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('class', 'epicycle-dot');
                dot.setAttribute('cx', x);
                dot.setAttribute('cy', y);
                dot.setAttribute('r', 6);
                epicyclesGroup.appendChild(dot);
            }

            finalDot.setAttribute('cx', x);
            finalDot.setAttribute('cy', y);
            connectorLine.setAttribute('x1', x);
            connectorLine.setAttribute('y1', y);
            connectorLine.setAttribute('x2', WAVE_START_X);
            connectorLine.setAttribute('y2', y);

            if (numTerms > 0) {
                 wavePoints.unshift({x: WAVE_START_X, y: y});
            }

            if (wavePoints.length > 1500) {
                wavePoints.pop();
            }

            let pathData = wavePoints.length > 0 ? `M ${wavePoints[0].x} ${wavePoints[0].y} ` + wavePoints.slice(1).map(p => `L ${p.x} ${p.y}`).join(' ') : "";
            wavePath.setAttribute('d', pathData);
            
            time += 0.01;
            animationFrameId = requestAnimationFrame(animate);
        }

        // --- Scene Management ---
        function runTimeline() {
            // Scene 1 & 2
            setTimeout(() => {
                setSubtitle('scene1');
                titleEl.classList.add('visible');
                targetWavePath.style.opacity = '1';
                setTimeout(() => setSubtitle('scene2'), 2500);
            }, timeline[0].time);
            
            // Scene 3
            setTimeout(() => {
                setSubtitle('scene3');
                numTerms = 1;
            }, timeline[1].time);

            // Scene 4
            setTimeout(() => {
                setSubtitle('scene4');
                numTerms = 2;
            }, timeline[2].time);
            
            // Scene 5
            setTimeout(() => {
                setSubtitle('scene5');
                let termIncreaseInterval = setInterval(() => {
                    if (numTerms < 50) { // Increased max terms
                        numTerms += 1;
                    } else {
                        clearInterval(termIncreaseInterval);
                    }
                }, 150); // Faster increase
            }, timeline[3].time);
            
            // Scene 6
            setTimeout(() => {
                setSubtitle('scene6');
                formulaContainer.classList.add('visible');
            }, timeline[4].time);
        }

        function drawTargetWave() {
            let path = 'M ' + WAVE_START_X + ' ' + (CY - AMPLITUDE);
            for (let i = 0; i < 1500; i++) {
                const x = WAVE_START_X + i;
                const y = ((i % 500) < 250) ? CY - AMPLITUDE : CY + AMPLITUDE;
                path += ` L ${x} ${y}`;
            }
            targetWavePath.setAttribute('d', path);
            targetWavePath.style.opacity = '0'; // Initially hidden
        }
        
        // --- Initialization ---
        window.onload = () => {
            drawTargetWave();
            runTimeline();
            animate();
            // No resize listener needed, CSS handles responsiveness
        };
    </script>
</body>
</html>